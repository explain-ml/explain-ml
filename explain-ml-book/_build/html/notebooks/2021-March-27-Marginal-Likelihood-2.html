
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Trying empirical bayesian inference &#8212; Explain-ML</title>
    
  <link rel="stylesheet" href="../_static/css/index.f658d18f9b420779cfdf24aa0a7e2d77.css">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      
  <link rel="stylesheet"
    href="../_static/vendor/open-sans_all/1.44.1/index.css">
  <link rel="stylesheet"
    href="../_static/vendor/lato_latin-ext/1.44.1/index.css">

    
    <link rel="stylesheet" href="../_static/sphinx-book-theme.e7340bb3dbd8dde6db86f25597f54a1b.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.d3f166471bb80abb5163.js">

    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/language_data.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/sphinx-book-theme.7d483ff0a819d6edff12ce0b1ead3928.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe,.cell"
        const thebe_selector_input = "pre,.cell_input div.highlight"
        const thebe_selector_output = ".output,.cell_output"
    </script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="&lt;no title&gt;" href="2021-March-27-Marginal-Likelihood.html" />
    <link rel="prev" title="&lt;no title&gt;" href="2021-March-26-GMM-example.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />



  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="../index.html">
  
  <img src="../_static/Logo.png" class="logo" alt="logo">
  
  
  <h1 class="site-logo" id="site-title">Explain-ML</h1>
  
</a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form>
<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
    <ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../intro.html">
   Explain ML
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  Linear Algebra for ML
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="2021-March-15-eigen.html">
   Eigen values
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="2021-March-15-determinant.html">
   Determinant
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="2021-March-15-Positive-semi-definite.html">
   Positive definiteness
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  Stochastic processes
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="2021-March-19-stochastic-processes.html">
   Stochastic processes
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="2021-March-17-Stationary-Time_Series.html">
   Stationarity of time-series
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="2021-March-17-Stationary-Time_Series.html#what-is-a-time-series">
   What is a time-series?
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="2021-March-17-Stationary-Time_Series.html#id1">
   What is a time-series?
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="2021-March-17-Stationary-Time_Series.html#what-is-a-stochastic-process">
   What is a stochastic process?
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="2021-March-17-Stationary-Time_Series.html#connection-between-time-series-and-stochastic-process">
   Connection between time-series and stochastic process
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="2021-March-17-Stationary-Time_Series.html#stationary-time-series-process">
   Stationary time-series process
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="2021-March-17-Stationary-Time_Series.html#why-stationarity-is-important">
   Why stationarity is important?
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="2021-March-17-Stationary-Time_Series.html#how-to-check-for-stationarity">
   How to check for stationarity?
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="2021-March-17-Stationary-Time_Series.html#linear-time-series-model">
   Linear time-series model
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="2021-March-17-Stationary-Time_Series.html#characteristic-equation-and-unit-root">
   Characteristic equation and unit root
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="2021-March-17-Stationary-Time_Series.html#id2">
   Characteristic equation and unit root
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="2021-March-17-Stationary-Time_Series.html#stationarity">
   Stationarity
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="2021-March-17-Stationary-Time_Series.html#how-to-convert-non-stationary-time-series-to-stationary">
   How to convert non-stationary Time-series to stationary?
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  Others
 </span>
</p>
<ul class="current nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="2021-March-11-blr-pymc.html">
   Laplacian Prior (LASSO)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="2021-March-17-LLS-GP-PyMC3.html">
   Stationary GP model
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="2021-March-17-LLS-GP-PyMC3.html#lls-gp">
   LLS GP
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="2021-March-23-GMM.html">
   Step 1
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="2021-March-23-bayesian-ml.html">
   Bayesian ML
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="2021-March-23-bayesian-ml.html#what-is-the-intuition-behind-the-bayesian-update-itempool">
   What is the intuition behind the Bayesian update? itempool
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="2021-March-23-bayesian-ml.html#but-what-is-the-likelihood-to-how-likely-the-event-is-given-a-belief-parameters">
   But what is the Likelihood? $\to$ How likely the event is, given a belief (parameters)?
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="2021-March-23-bayesian-ml.html#prior-beliefs-over-parameters">
   Prior beliefs over parameters
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="2021-March-23-bayesian-ml.html#how-to-choose-appropriate-prior-for-likelihood-or-model-to-conjugate-priors">
   How to choose appropriate prior for likelihood (or model)? $\to$ Conjugate priors
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="2021-March-23-bayesian-ml.html#bayes-rule">
   Bayes rule
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="2021-March-23-bayesian-ml.html#evidence-p-d">
   Evidence $p(D)$
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="2021-March-23-bayesian-ml.html#full-posterior-prediction-for-coin-toss-experiment">
   Full posterior prediction for coin toss experiment
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Trying empirical bayesian inference
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="#drawing-samples-from-posterior">
   Drawing samples from posterior
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="#comparing-with-exact-inference">
   Comparing with exact inference
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="2021-March-29-bayesian-model-selection.html">
   Pseudo-random data (degree 3 polynomial)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="2021-March-29-bayesian-model-selection.html#marginal-likelihood-pdf">
   Marginal likelihood pdf
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="2021-March-29-bayesian-model-selection.html#models">
   Models
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="2021-March-29-bayesian-model-selection.html#model-selection">
   Model selection
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="2021-March-29-bayesian-model-selection.html#model-selection-with-parameter-optimization">
   Model selection with parameter optimization
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="2021-March-29-bayesian-model-selection.html#using-empirical-bayes-bishop">
   Using empirical bayes (Bishop)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="2021-March-29-bayesian-model-selection.html#drawbacks">
   Drawbacks
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="2021-March-31-derivation-of-marginal-likelihood.html">
   Marginal likelihood for Bayesian linear regression
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="2021-March-31-derivation-of-marginal-likelihood.html#begin-aligned">
   \begin{aligned}
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="2021-March-31-derivation-of-marginal-likelihood.html#id1">
   \begin{aligned}
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="2021-March-31-derivation-of-marginal-likelihood.html#id2">
   \begin{aligned}
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="2021-March-31-derivation-of-marginal-likelihood.html#products-of-gaussian-pdfs">
   Products of Gaussian PDFs
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="2021-March-31-derivation-of-marginal-likelihood.html#id3">
   \begin{aligned}
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="2021-March-31-derivation-of-marginal-likelihood.html#id4">
   \begin{aligned}
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="2021-March-31-derivation-of-marginal-likelihood.html#id5">
   \begin{aligned}
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="2021-March-31-derivation-of-marginal-likelihood.html#id6">
   \begin{aligned}
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="2021-March-31-derivation-of-marginal-likelihood.html#multiplication-of-two-gaussians">
   Multiplication of two Gaussians
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="2021-March-31-derivation-of-marginal-likelihood.html#what-is-the-relationship-between-marginal-likelihood-closed-form-and-any-calculations-done-in-multiplications-of-two-gaussians">
   What is the relationship between marginal_Likelihood_closed_form and any calculations done in multiplications of two gaussians?
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  References
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../references.html">
   References
  </a>
 </li>
</ul>

</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/notebooks/2021-March-27-Marginal-Likelihood-2.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->


            <!-- Full screen (wrap in <a> to have style consistency -->
            <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
                    data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
                    title="Fullscreen mode"><i
                        class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/explain-ml/explain-ml-book/main?urlpath=tree/notebooks/2021-March-27-Marginal-Likelihood-2.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        <a class="colab-button" href="https://colab.research.google.com/github/explain-ml/explain-ml-book/blob/main/notebooks/2021-March-27-Marginal-Likelihood-2.ipynb"><button type="button" class="btn btn-secondary topbarbtn"
                title="Launch Colab" data-toggle="tooltip" data-placement="left"><img class="colab-button-logo"
                    src="../_static/images/logo_colab.png"
                    alt="Interact on Colab">Colab</button></a>
        
        <button type="button" class="btn btn-secondary topbarbtn"
            onclick="initThebeSBT()" title="Launch Thebe" data-toggle="tooltip" data-placement="left"><i
                class="fas fa-play"></i><span style="margin-left: .4em;">Live Code</span></button>
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
        <div class="tocsection onthispage pt-5 pb-3">
            <i class="fas fa-list"></i>
            Contents
        </div>
        <nav id="bd-toc-nav">
            <ul class="nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   Trying empirical bayesian inference
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#drawing-samples-from-posterior">
   Drawing samples from posterior
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#comparing-with-exact-inference">
   Comparing with exact inference
  </a>
 </li>
</ul>

        </nav>
        
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">scipy.stats</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">scipy.integrate</span> <span class="kn">import</span> <span class="n">simps</span>
<span class="kn">import</span> <span class="nn">pyDOE2</span>
</pre></div>
</div>
</div>
</div>
<p>From MML book</p>
<p>Definition 6.3 (Expected Value). The expected value of a function $g: \mathbb{R} \rightarrow$ $\mathbb{R}$ of a univariate continuous random variable $X \sim p(x)$ is given by
$$
\mathbb{E}<em>{X}[g(x)]=\int</em>{\mathcal{X}} g(x) p(x) \mathrm{d} x
$$
Correspondingly, the expected value of a function $g$ of a discrete random variable $X \sim p(x)$ is given by
$$
\mathbb{E}<em>{X}[g(x)]=\sum</em>{x \in \mathcal{X}} g(x) p(x)
$$</p>
<p>From Nando De Freitas https://www.youtube.com/watch?v=mz3j59aJBZQ&amp;list=PLE6Wd9FR–EdyJ5lbFl8UuGjecvVw66F6&amp;index=16&amp;t=1957s</p>
<p>starting 50 mins</p>
<p>$I = \int_{\mathcal{X}} g(x)p(x)dx = \dfrac{\sum_{i=1}^N g(x_i)}{N}$ where $x_i \sim p(x)$ is a sample from p(x)</p>
<p>Example</p>
<p>$X \sim \mathcal{N}(0, 1)$</p>
<p>$g(x) = x$</p>
<p>$\mathbb{E}_{X}[g(x)] = \mu = 0$</p>
<p>Case II</p>
<p>$g(x) = x^2$</p>
<p>Now, we know that</p>
<p>$\mathbb{V}<em>{X}[x]=\mathbb{E}</em>{X}\left[x^{2}\right]-\left(\mathbb{E}_{X}[x]\right)^{2}$</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">N</span> <span class="o">=</span> <span class="mi">1000000</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">samples</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">N</span><span class="p">)</span>

<span class="n">mu_hat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">samples</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">mu_hat</span><span class="p">)</span>


<span class="n">exp_x2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">samples</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">exp_x2</span><span class="p">)</span>

<span class="n">var</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">var</span><span class="p">(</span><span class="n">samples</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">var</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.0015121465155362318
0.9998449448099948
0.9998426582229105
</pre></div>
</div>
</div>
</div>
<p>We can similarly approximate the marginal likelihood as follows:</p>
<p>Marginal likelihood = $\int_{\mathcal{\theta}} P(D|\theta) P(\theta)d\theta = I = \dfrac{\sum_{i=1}^N P(D|\theta_i)}{N}$ where $\theta_i$ is drawn from $p(\theta)$</p>
<p>To do:</p>
<p>Linear regression in say two variables. Prior is $p(\theta)\sim \mathcal{N}([0, 0]^T, I)$. We can easily draw samples from this prior then the obtained sample can be used to calculate the likelihood. The marginal likelihood is the empirical mean of likelihoods derived in this way.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">### Generating pseudo-random data</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">N</span> <span class="o">=</span> <span class="mi">100</span> <span class="c1"># Number of samples</span>
<span class="n">sigma_n</span> <span class="o">=</span> <span class="mi">20</span> <span class="c1"># Noise std in data</span>
<span class="n">sigma</span> <span class="o">=</span> <span class="mi">100</span> <span class="c1"># Prior std on theta</span>
<span class="n">theta_real</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span><span class="mi">10</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">N_theta</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">theta_real</span><span class="p">)</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="n">N</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">x_with_bias</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">N</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span> <span class="n">x</span><span class="p">])</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">multivariate_normal</span><span class="p">((</span><span class="n">x_with_bias</span><span class="nd">@theta_real</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">*</span><span class="n">sigma_n</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">);</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;x = </span><span class="si">{</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s1">, y = </span><span class="si">{</span><span class="n">y</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>x = (100, 1), y = (100, 1)
</pre></div>
</div>
<img alt="../_images/2021-March-27-Marginal-Likelihood-2_8_1.png" src="../_images/2021-March-27-Marginal-Likelihood-2_8_1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Likelihood function</span>
<span class="n">noise_cov</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">*</span><span class="n">sigma_n</span><span class="o">**</span><span class="mi">2</span>
<span class="k">def</span> <span class="nf">LinRegLikelihood</span><span class="p">(</span><span class="n">theta0</span><span class="p">,</span> <span class="n">theta1</span><span class="p">):</span> <span class="c1"># Direct pdf</span>
    <span class="k">return</span> <span class="n">scipy</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">multivariate_normal</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">y</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(),</span> <span class="p">(</span><span class="n">x_with_bias</span><span class="nd">@np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">theta0</span><span class="p">,</span> <span class="n">theta1</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">noise_cov</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Calculations</span>
<span class="n">vec_func</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vectorize</span><span class="p">(</span><span class="n">LinRegLikelihood</span><span class="p">)</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">Prior_thetas</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">multivariate_normal</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">N_theta</span><span class="p">)</span><span class="o">*</span><span class="n">sigma</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">100000</span><span class="p">)</span>
<span class="n">Likelihoods</span> <span class="o">=</span> <span class="n">vec_func</span><span class="p">(</span><span class="n">Prior_thetas</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">Prior_thetas</span><span class="p">[:,</span><span class="mi">1</span><span class="p">])</span>
<span class="n">MarginalLikelihood</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">Likelihoods</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Prior_thetas&#39;</span><span class="p">,</span> <span class="n">Prior_thetas</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Likelihoods&#39;</span><span class="p">,</span> <span class="n">Likelihoods</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;MarginalLikelihood&#39;</span><span class="p">,</span> <span class="n">MarginalLikelihood</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="s1">&#39;value =&#39;</span><span class="p">,</span><span class="n">MarginalLikelihood</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">MarginalLikelihood</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[-449.18278911]])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">scipy</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">multivariate_normal</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">y</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(),</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">N</span><span class="p">),</span> <span class="p">(</span><span class="n">x_with_bias</span><span class="nd">@x_with_bias</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">*</span><span class="n">sigma</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">*</span><span class="n">sigma_n</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>-451.18739650293173
</pre></div>
</div>
</div>
</div>
<div class="section" id="trying-empirical-bayesian-inference">
<h1>Trying empirical bayesian inference<a class="headerlink" href="#trying-empirical-bayesian-inference" title="Permalink to this headline">¶</a></h1>
<p>We have marginal likelihood now. Let us try to approximate posterior pdf based on prior pdf.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">LHS_thetas</span> <span class="o">=</span> <span class="n">pyDOE2</span><span class="o">.</span><span class="n">doe_lhs</span><span class="o">.</span><span class="n">lhs</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">samples</span><span class="o">=</span><span class="mi">100000</span><span class="p">)</span><span class="o">*</span><span class="mi">40</span> <span class="o">-</span> <span class="mi">20</span>
<span class="n">Likelihoods</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">LinRegLikelihood</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="k">for</span> <span class="n">theta</span> <span class="ow">in</span> <span class="n">LHS_thetas</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">Prior_pdf</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">multivariate_normal</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">LHS_thetas</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">sigma</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">mp</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">LHS_thetas</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">LHS_thetas</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="n">Prior_pdf</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">mp</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;theta_0&#39;</span><span class="p">);</span><span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;theta_1&#39;</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Prior ditribution of theta&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/2021-March-27-Marginal-Likelihood-2_14_0.png" src="../_images/2021-March-27-Marginal-Likelihood-2_14_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Posterior_pdf</span> <span class="o">=</span> <span class="p">(</span><span class="n">Likelihoods</span><span class="o">*</span><span class="n">Prior_pdf</span><span class="p">)</span><span class="o">/</span><span class="n">MarginalLikelihood</span>
<span class="n">mp</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">LHS_thetas</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">LHS_thetas</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="n">Posterior_pdf</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">mp</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;theta_0&#39;</span><span class="p">);</span><span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;theta_1&#39;</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Posterior ditribution of theta&#39;</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">15</span><span class="p">);</span><span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/2021-March-27-Marginal-Likelihood-2_15_0.png" src="../_images/2021-March-27-Marginal-Likelihood-2_15_0.png" />
</div>
</div>
</div>
<div class="section" id="drawing-samples-from-posterior">
<h1>Drawing samples from posterior<a class="headerlink" href="#drawing-samples-from-posterior" title="Permalink to this headline">¶</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Posterior_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Posterior_pdf</span><span class="p">),</span> <span class="n">size</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="n">Posterior_pdf</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span><span class="o">/</span><span class="n">Posterior_pdf</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>
<span class="n">Posterior_thetas</span> <span class="o">=</span> <span class="n">LHS_thetas</span><span class="p">[</span><span class="n">Posterior_idx</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## Posterior mean and covariance</span>
<span class="n">Posterior_thetas</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">cov</span><span class="p">(</span><span class="n">Posterior_thetas</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(array([2.09319469, 9.59569423]),
 array([[5.37638641, 0.52119208],
        [0.52119208, 0.20137299]]))
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="comparing-with-exact-inference">
<h1>Comparing with exact inference<a class="headerlink" href="#comparing-with-exact-inference" title="Permalink to this headline">¶</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">S0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">sigma</span><span class="o">**</span><span class="mi">2</span>
<span class="n">M0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>

<span class="n">Sn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">S0</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">x_with_bias</span><span class="o">.</span><span class="n">T</span><span class="nd">@x_with_bias</span><span class="p">)</span><span class="o">/</span><span class="n">sigma_n</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<span class="n">Mn</span> <span class="o">=</span> <span class="n">Sn</span><span class="o">@</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">S0</span><span class="p">)</span><span class="nd">@M0</span> <span class="o">+</span> <span class="p">(</span><span class="n">x_with_bias</span><span class="o">.</span><span class="n">T</span><span class="nd">@y</span><span class="p">)</span><span class="o">/</span><span class="n">sigma_n</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<span class="n">Mn</span><span class="p">,</span> <span class="n">Sn</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(array([[2.2033994 ],
        [9.60324818]]),
 array([[5.30408854, 0.52248407],
        [0.52248407, 0.20907722]]))
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Sn</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[5.30408854, 0.52248407],
       [0.52248407, 0.20907722]])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="mi">1</span><span class="o">/</span><span class="p">((</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span><span class="o">**</span><span class="n">Sn</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">det</span><span class="p">(</span><span class="n">Sn</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.030300320902152397
</pre></div>
</div>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "explain-ml/explain-ml-book",
            ref: "main",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./notebooks"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        
        <div class='prev-next-bottom'>
            
    <a class='left-prev' id="prev-link" href="2021-March-26-GMM-example.html" title="previous page">&lt;no title&gt;</a>
    <a class='right-next' id="next-link" href="2021-March-27-Marginal-Likelihood.html" title="next page">&lt;no title&gt;</a>

        </div>
        
        </div>
    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By Nipun Batra, Zeel B Patel<br/>
        
            &copy; Copyright 2021.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>

    
  <script src="../_static/js/index.d3f166471bb80abb5163.js"></script>


    
  </body>
</html>